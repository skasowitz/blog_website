{
  "hash": "41f7963684721dd331f42c251b2631e8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"30DayMapChallenge Days 02 & 03 - Lines & Polygons\"\ndescription: \"\"\ndate: \"2025-11-03\"\nimage: featured.png\nimage-alt: Map of the United States of America with flights connecting through JFK drawn as arcs.\ncategories:\n  - 30DayMapChallenge\n  - Data visualization\n  - R\n  - ggplot2\n  - Geospatial\ntoc: true\nnumber-sections: true\ncitation: true\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\nexecute:\n  echo: true\n  warning: false\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(anyflights)\nlibrary(tidyverse)\nlibrary(geosphere)\nlibrary(maps)\nlibrary(ggrepel)\n```\n:::\n\n\nFlight data from the (Bureau of Transportation Statistics)[https://www.bts.gov/].\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights <- read_csv(\n  'D:/Projects/FlightData/On_Time_Reporting_Carrier_On_Time_Performance_(1987_present)_2024_12.csv'\n)\n\nglimpse(flights)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 590,581\nColumns: 110\n$ Year                            <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 20…\n$ Quarter                         <dbl> 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,…\n$ Month                           <dbl> 12, 12, 12, 12, 12, 12, 12, 12, 12, 12…\n$ DayofMonth                      <dbl> 25, 26, 27, 28, 29, 30, 31, 19, 20, 21…\n$ DayOfWeek                       <dbl> 3, 4, 5, 6, 7, 1, 2, 4, 5, 6, 7, 1, 2,…\n$ FlightDate                      <date> 2024-12-25, 2024-12-26, 2024-12-27, 2…\n$ Reporting_Airline               <chr> \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9…\n$ DOT_ID_Reporting_Airline        <dbl> 20363, 20363, 20363, 20363, 20363, 203…\n$ IATA_CODE_Reporting_Airline     <chr> \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9…\n$ Tail_Number                     <chr> \"N902XJ\", \"N491PX\", \"N915XJ\", \"N917XJ\"…\n$ Flight_Number_Reporting_Airline <dbl> 5125, 5125, 5125, 5125, 5125, 5125, 51…\n$ OriginAirportID                 <dbl> 11995, 11995, 11995, 11995, 11995, 119…\n$ OriginAirportSeqID              <dbl> 1199502, 1199502, 1199502, 1199502, 11…\n$ OriginCityMarketID              <dbl> 31995, 31995, 31995, 31995, 31995, 319…\n$ Origin                          <chr> \"GSO\", \"GSO\", \"GSO\", \"GSO\", \"GSO\", \"GS…\n$ OriginCityName                  <chr> \"Greensboro/High Point, NC\", \"Greensbo…\n$ OriginState                     <chr> \"NC\", \"NC\", \"NC\", \"NC\", \"NC\", \"NC\", \"N…\n$ OriginStateFips                 <chr> \"37\", \"37\", \"37\", \"37\", \"37\", \"37\", \"3…\n$ OriginStateName                 <chr> \"North Carolina\", \"North Carolina\", \"N…\n$ OriginWac                       <dbl> 36, 36, 36, 36, 36, 36, 36, 22, 22, 22…\n$ DestAirportID                   <dbl> 12953, 12953, 12953, 12953, 12953, 129…\n$ DestAirportSeqID                <dbl> 1295304, 1295304, 1295304, 1295304, 12…\n$ DestCityMarketID                <dbl> 31703, 31703, 31703, 31703, 31703, 317…\n$ Dest                            <chr> \"LGA\", \"LGA\", \"LGA\", \"LGA\", \"LGA\", \"LG…\n$ DestCityName                    <chr> \"New York, NY\", \"New York, NY\", \"New Y…\n$ DestState                       <chr> \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"N…\n$ DestStateFips                   <chr> \"36\", \"36\", \"36\", \"36\", \"36\", \"36\", \"3…\n$ DestStateName                   <chr> \"New York\", \"New York\", \"New York\", \"N…\n$ DestWac                         <dbl> 22, 22, 22, 22, 22, 22, 22, 36, 36, 36…\n$ CRSDepTime                      <chr> \"1240\", \"1150\", \"1150\", \"1100\", \"1150\"…\n$ DepTime                         <chr> \"1235\", \"1146\", \"1144\", \"1214\", \"1141\"…\n$ DepDelay                        <dbl> -5, -4, -6, 74, -9, -12, -5, -7, -3, -…\n$ DepDelayMinutes                 <dbl> 0, 0, 0, 74, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ DepDel15                        <dbl> 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ DepartureDelayGroups            <dbl> -1, -1, -1, 4, -1, -1, -1, -1, -1, -1,…\n$ DepTimeBlk                      <chr> \"1200-1259\", \"1100-1159\", \"1100-1159\",…\n$ TaxiOut                         <dbl> 11, 15, 13, 13, 17, 14, 13, 21, 31, 53…\n$ WheelsOff                       <chr> \"1246\", \"1201\", \"1157\", \"1227\", \"1158\"…\n$ WheelsOn                        <chr> \"1350\", \"1305\", \"1301\", \"1333\", \"1303\"…\n$ TaxiIn                          <dbl> 6, 5, 6, 7, 8, 9, 6, 4, 5, 4, 4, 3, 6,…\n$ CRSArrTime                      <chr> \"1429\", \"1336\", \"1336\", \"1244\", \"1336\"…\n$ ArrTime                         <chr> \"1356\", \"1310\", \"1307\", \"1340\", \"1311\"…\n$ ArrDelay                        <dbl> -33, -26, -29, 56, -25, -31, -27, -25,…\n$ ArrDelayMinutes                 <dbl> 0, 0, 0, 56, 0, 0, 0, 0, 1, 4, 0, 0, 2…\n$ ArrDel15                        <dbl> 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1,…\n$ ArrivalDelayGroups              <dbl> -2, -2, -2, 3, -2, -2, -2, -2, 0, 0, -…\n$ ArrTimeBlk                      <chr> \"1400-1459\", \"1300-1359\", \"1300-1359\",…\n$ Cancelled                       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ CancellationCode                <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Diverted                        <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ CRSElapsedTime                  <dbl> 109, 106, 106, 104, 106, 106, 109, 121…\n$ ActualElapsedTime               <dbl> 81, 84, 83, 86, 90, 87, 87, 103, 125, …\n$ AirTime                         <dbl> 64, 64, 64, 66, 65, 64, 68, 78, 89, 74…\n$ Flights                         <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ Distance                        <dbl> 461, 461, 461, 461, 461, 461, 461, 461…\n$ DistanceGroup                   <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…\n$ CarrierDelay                    <dbl> NA, NA, NA, 0, NA, NA, NA, NA, NA, NA,…\n$ WeatherDelay                    <dbl> NA, NA, NA, 0, NA, NA, NA, NA, NA, NA,…\n$ NASDelay                        <dbl> NA, NA, NA, 0, NA, NA, NA, NA, NA, NA,…\n$ SecurityDelay                   <dbl> NA, NA, NA, 0, NA, NA, NA, NA, NA, NA,…\n$ LateAircraftDelay               <dbl> NA, NA, NA, 56, NA, NA, NA, NA, NA, NA…\n$ FirstDepTime                    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ TotalAddGTime                   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ LongestAddGTime                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ DivAirportLandings              <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ DivReachedDest                  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ DivActualElapsedTime            <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ DivArrDelay                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ DivDistance                     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1Airport                     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1AirportID                   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1AirportSeqID                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1WheelsOn                    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1TotalGTime                  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1LongestGTime                <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1WheelsOff                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div1TailNum                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2Airport                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2AirportID                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2AirportSeqID                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2WheelsOn                    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2TotalGTime                  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2LongestGTime                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2WheelsOff                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div2TailNum                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3Airport                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3AirportID                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3AirportSeqID                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3WheelsOn                    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3TotalGTime                  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3LongestGTime                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3WheelsOff                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div3TailNum                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4Airport                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4AirportID                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4AirportSeqID                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4WheelsOn                    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4TotalGTime                  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4LongestGTime                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4WheelsOff                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div4TailNum                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5Airport                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5AirportID                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5AirportSeqID                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5WheelsOn                    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5TotalGTime                  <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5LongestGTime                <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5WheelsOff                   <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ Div5TailNum                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ ...110                          <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairports <- get_airports(dir = tempdir()) |>\n  select(faa, name, lat, lon)\n\nglimpse(airports)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,251\nColumns: 4\n$ faa  <chr> \"AAF\", \"AAP\", \"ABE\", \"ABI\", \"ABL\", \"ABQ\", \"ABR\", \"ABY\", \"ACK\", \"A…\n$ name <chr> \"Apalachicola Regional Airport\", \"Andrau Airpark\", \"Lehigh Valley…\n$ lat  <dbl> 29.72750, 29.72250, 40.65210, 32.41130, 67.10630, 35.04020, 45.44…\n$ lon  <dbl> -85.02750, -95.58830, -75.44080, -99.68190, -157.85699, -106.6090…\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njfk_flights <- flights |>\n  filter(\n    between(FlightDate, ymd('2024-12-20'), ymd('2024-12-31')) &\n      (Origin == \"JFK\" | Dest == \"JFK\")\n  ) |>\n  select(\n    FlightDate,\n    Reporting_Airline,\n    Origin,\n    OriginCityName,\n    OriginState,\n    Dest,\n    DestCityName,\n    DestState\n  )\n\nglimpse(jfk_flights)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 7,428\nColumns: 8\n$ FlightDate        <date> 2024-12-20, 2024-12-21, 2024-12-22, 2024-12-23, 202…\n$ Reporting_Airline <chr> \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9E\", \"9E\"…\n$ Origin            <chr> \"BGR\", \"BGR\", \"BGR\", \"BGR\", \"BGR\", \"BGR\", \"BGR\", \"BG…\n$ OriginCityName    <chr> \"Bangor, ME\", \"Bangor, ME\", \"Bangor, ME\", \"Bangor, M…\n$ OriginState       <chr> \"ME\", \"ME\", \"ME\", \"ME\", \"ME\", \"ME\", \"ME\", \"ME\", \"ME\"…\n$ Dest              <chr> \"JFK\", \"JFK\", \"JFK\", \"JFK\", \"JFK\", \"JFK\", \"JFK\", \"JF…\n$ DestCityName      <chr> \"New York, NY\", \"New York, NY\", \"New York, NY\", \"New…\n$ DestState         <chr> \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\", \"NY\"…\n```\n\n\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflight_counts <- jfk_flights |>\n  count(Origin, Dest) |>\n  left_join(airports |> select(-name), by = join_by('Origin' == 'faa')) |>\n  rename(origin_lat = lat, origin_lon = lon) |>\n  left_join(airports |> select(-name), by = join_by('Dest' == 'faa')) |>\n  rename(dest_lat = lat, dest_lon = lon)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_routes <- flight_counts |>\n  slice_max(order_by = n, n = 10) |>\n  distinct(Dest, .keep_all = TRUE)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflight_counts <- flight_counts |>\n  filter(\n    !is.na(origin_lat),\n    !is.na(origin_lon),\n    !is.na(dest_lat),\n    !is.na(dest_lon)\n  ) |>\n  filter(!(origin_lat == dest_lat & origin_lon == dest_lon))\n\narriving_counts <- flight_counts |>\n  filter(Dest == \"JFK\")\ndeparting_counts <- flight_counts |>\n  filter(Origin == \"JFK\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngreat_circle_arcs <- flight_counts |>\n  # Add a unique identifier for each flight path\n  mutate(id = row_number()) %>%\n  # Ensure all numeric values are actually finite\n  filter_at(vars(origin_lat:dest_lon), all_vars(is.finite(.))) %>%\n  rowwise() %>%\n  do({\n    # Capture the current row's ID and count before calculating the arc\n    current_id <- .$id\n    current_n <- .$n\n\n    gc <- gcIntermediate(\n      c(.$origin_lon, .$origin_lat),\n      c(.$dest_lon, .$dest_lat),\n      n = 50,\n      addStartEnd = TRUE,\n      breakAtDateLine = TRUE\n    )\n\n    # Robustly handle matrix and vector outputs, and explicitly attach ID and N\n    if (is.matrix(gc)) {\n      as.data.frame(gc) %>%\n        rename(long = lon) %>%\n        # Explicitly attach the captured ID and N\n        mutate(id = current_id, n = current_n)\n    } else {\n      # Handle case where gc is a simple vector (start/end points only)\n      tibble(\n        long = c(.$origin_lon, .$dest_lon),\n        lat = c(.$origin_lat, .$dest_lat)\n      ) %>%\n        # Explicitly attach the captured ID and N\n        mutate(id = current_id, n = current_n)\n    }\n  }) %>%\n  ungroup()\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get world map data\nworld_map <- map_data(\"world\")\n\n# Filter the map to focus on the continental US (approximate boundaries)\nus_map <- world_map %>%\n  filter(region %in% c(\"USA\", \"Canada\", \"Mexico\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_polygon(\n    data = us_map,\n    aes(\n      x = long,\n      y = lat,\n      group = group\n    ),\n    fill = 'grey85',\n    color = 'grey55',\n    linewidth = 0.1\n  ) +\n  geom_path(\n    data = great_circle_arcs,\n    aes(x = long, y = lat, group = id, alpha = n, linewidth = n),\n    color = 'dodgerblue'\n  ) +\n  geom_point(\n    data = flight_counts,\n    aes(x = dest_lon, y = dest_lat),\n    color = \"#D55E00\",\n    size = 1.5\n  ) +\n  geom_point(\n    data = flight_counts,\n    aes(x = origin_lon, y = origin_lat),\n    color = \"#009E73\",\n    size = 1.5\n  ) +\n  geom_label_repel(\n    data = top_routes,\n    aes(x = dest_lon, y = dest_lat, label = Dest)\n  ) +\n  coord_sf(xlim = c(-125, -65), ylim = c(25, 50), expand = FALSE) +\n  labs(\n    title = \"2024 End of Year Domestic Connections to JFK\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = 'none',\n    plot.title = element_text(face = \"bold\"),\n    panel.grid.major = element_line(color = \"grey95\"),\n    panel.grid.minor = element_line(color = \"grey95\"),\n    axis.text = element_blank(), # Remove lat/long tick labels for a cleaner map\n    axis.title = element_blank() # Remove axis titles)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}